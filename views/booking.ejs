<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Bookings</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <style>
    body {
      font-family: "Poppins", sans-serif;
      margin: 0;
      background: #f4f6fc;
      padding-bottom: 80px;
    }

    /* ---------------- HEADER ---------------- */
    .top-header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: #fbfdff;
      color: rgb(0, 0, 0);
      padding: 16px;
      font-size: 1.2rem;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(158, 157, 157, 0.15);
    }

    /* ---------------- TABS ---------------- */
    .tabs-wrapper {
      position: sticky;
      top: 60px;
      z-index: 40;
      background: #f4f6fc;
      padding: 10px 0;
    }

    .tabs {
      display: flex;
      overflow-x: auto;
      gap: 10px;
      padding: 0 12px;
    }

    .tabs::-webkit-scrollbar {
      display: none;
    }

    .tab {
      padding: 8px 16px;
      border-radius: 20px;
      background: #e5e7eb;
      font-size: 0.85rem;
      white-space: nowrap;
      cursor: pointer;
      transition: 0.2s;
    }

    .tab.active {
      background: #fcbf49;
      color: white;
    }

    /* ---------------- BOOKING CARDS ---------------- */
    .content-area {
      padding: 16px;
    }

    .booking-card {
      background: #fff;
      padding: 18px;
      border-radius: 16px;
      margin-bottom: 18px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.07);
      cursor: pointer;
      transition: 0.2s ease;
    }

    .booking-card:hover {
      background: #fafafa;
    }

    /* TOP BAR: Provider Name (Left) + Price (Right) */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .provider-name {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
      color: #111827;
    }

    .price {
      margin: 0;
      font-weight: 700;
      font-size: 1rem;
    }

    /* BOTTOM BAR: Service + Date (Left) and Status (Right) */
    .bottom-bar {
      display: flex;
      justify-content: space-between;
      margin-top: 12px;
    }

    .left-bottom {
      max-width: 75%;
    }

    .service-title {
      font-size: 1.05rem;
      font-weight: 600;
      margin: 0 0 5px 0;
    }

    .date-line {
      font-size: 0.83rem;
      color: #6b7280;
      margin: 0;
    }

    .right-bottom {
      display: flex;
      align-items: flex-start;
    }

    /* STATUS BADGE (Bottom Right) */
    .status {
      padding: 5px 12px;
      font-size: 0.7rem;
      border-radius: 8px;
      font-weight: 600;
      white-space: nowrap;
    }

    /* STATUS COLORS */
    .completed-badge {
      background: #e3f2ff;
      color: #0b63cc;
    }

    .ongoing-badge {
      background: #fce7f3;
      color: #c026d3;
    }

    .upcoming-badge {
      background: #e9f8e8;
      color: #15803d;
    }

    .cancelled-badge {
      background: #ffe4e6;
      color: #e11d48;
    }

    .reject-btn {
      background: #f87171;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .btn {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .btn-row {
      margin-top: 12px;
      display: flex;
      gap: 10px;
    }

    /* ---------------- BOTTOM NAV ---------------- */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #ffffff;
      display: flex;
      justify-content: space-around;
      align-items: center;
      border-top: 1px solid #ddd;
      padding: 12px 0;
      z-index: 100;
    }

    .bottom-nav div {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 0.82rem;
      color: gray;
      cursor: pointer;
    }

    .bottom-nav .active {
      color: #fcbf49;
    }

    .bottom-nav i {
      font-size: 1.35rem;
      margin-bottom: 5px;
    }
  </style>
</head>

<body>

  <!-- FIXED HEADER -->
  <div class="top-header">
    My Bookings
  </div>

  <!-- FIXED TABS -->
  <div class="tabs-wrapper">
    <div class="tabs">
      <div class="tab" onclick="filterBookings('all', event)">All</div>
      <div class="tab active" onclick="filterBookings('requested', event)">Requested</div>
      <div class="tab" onclick="filterBookings('ongoing', event)">Ongoing</div>
      <div class="tab" onclick="filterBookings('completed', event)">Completed</div>
      <div class="tab" onclick="filterBookings('cancelled', event)">Cancelled</div>
    </div>
  </div>

  <!-- BOOKINGS LIST -->
  <div class="content-area">

    <% bookings.forEach(b=> { %>

      <div class="booking-card" data-status="<%= b.status %>"
        onclick="window.location.href='/service/details/<%= b.serviceId %>'">

        <!-- TOP: PROVIDER NAME (LEFT) + PRICE (RIGHT) -->
        <div class="top-bar">
          <p class="provider-name">
            <%= b.providerName %>
          </p>
          <p class="price">â‚¹<%= b.price %>
          </p>
        </div>

        <!-- BOTTOM: SERVICE + DATE (LEFT) & STATUS (RIGHT) -->
        <div class="bottom-bar">
          <div class="left-bottom">
            <p class="service-title">
              <%= b.serviceName %>
            </p>
            <p class="date-line">
              <%= new Date(b.date).toLocaleString("en-IN", { weekday: "short" , month: "short" , day: "numeric" ,
                year: "numeric" }) %>
            </p>
          </div>

          <div class="right-bottom">

            <% if (b.status==="requested" ) { %>
              <!-- Show nothing for requested -->
              <% } else if (b.status==="ongoing" ) { %>
                <span class="status ongoing-badge">Ongoing</span>
                <% } else if (b.status==="completed" ) { %>
                  <span class="status completed-badge">Completed</span>
                  <% } else if (b.status==="cancelled" ) { %>
                    <span class="status cancelled-badge">Cancelled</span>
                    <% } %>
          </div>
        </div>
        <!-- ACTION BUTTONS -->
        <div class="btn-row">

          <% if (b.status==="requested" ) { %>

            <form action="/provider/booking/reject/<%= b._id %>" method="POST">
              <button  class="btn reject-btn">Reject</button>
            </form>
            <% } %>
        </div>
      </div>
      <% }) %>
  </div>

  <!-- BOTTOM NAVIGATION -->
  <div class="bottom-nav">
    <div onclick="window.location.href='/page/home'">
      <i class="bi bi-house"></i>
      <span>Home</span>
    </div>

    <div onclick="window.location.href='/page/categories'">
      <i class="bi bi-grid"></i>
      <span>Categories</span>
    </div>

    <div class="active">
      <i class="bi bi-clipboard"></i>
      <span>Bookings</span>
    </div>

    <div onclick="window.location.href='/page/profile'">
      <i class="bi bi-person"></i>
      <span>Profile</span>
    </div>
  </div>

  <script>
    function filterBookings(status, e) {
      document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
      e.target.classList.add("active");

      document.querySelectorAll(".booking-card").forEach(card => {
        if (status === "all") card.style.display = "block";
        else card.style.display = (card.dataset.status === status) ? "block" : "none";
      });
    }
  </script>
  <!-- DEFAULT FILTER -->
  <script>
    window.onload = function () {
      const defaultTab = document.querySelector(".tab.active");
      filterBookings('requested', { target: defaultTab });
    };
  </script>

</body>

</html>